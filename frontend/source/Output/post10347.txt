Why have 5 different iMacs developed corrupt OS X partitions when the physical drives are fine? <body> I'm a tech for my local school district and we are having some problems with our iMac Multimedia Lab. Over the past nine months, 5 of the 22 iMacs have suffered from filesystem corruption. The only recourse for these machines has been to completely wipe out the OS X partition and start fresh (with appropriate restore from Time Machine.)  strongHere's the list for why I know it's file system corruption:/strong  ul liThe iMac will not boot OS X. I have seen it stop at the "throbber", the progress bar, or just the Apple logo./li liMounting the iMac disk via Target Disk Mode (love that feature) succeeds, but only for the Bootcamp partition. The OS X partition fails to mount./li liA verify of the disk reveals the OS X partition needs to be repaired (I've seen invalid sibling entries, orphaned children etc.). Attempting to repair the disk fails. This latest attempt (just yesterday) said that the catalog B trees could not be rebuilt. I should have made more complete notes on what was said each time, but each time until this last one I assumed it was an odd one-in-a-million kind of event. A fluke/li liAttempting to repair or rebuild the drives with Drive Genius 3 also fails So far 98% of the user's files have been recoverable via Data Rescue 3 The physical hard drive does not appear to be failing (retrieving files from the drive does not hang or "beachball", the drive does not appear and disappear in Disk Utility, Finder remains responsive, etc.)/li liNormally I'd chalk it up to a series of bad drives. Just happened to be the unlucky guy who purchased a bad run of iMacs, right? Here's where things start to get interesting. I submit to you, the list of oddities:/li liThe drives verify as good via SMART/li liThe RAM checks out/li liAfter deleting and re-creating the partition (and re-installing OS X) all problems disappear./li liThe corruption has not happened to the same Mac twice/li liBootcamp is installed on the same drive and functions before, after, and during the corruption on the Mac side./li liThe Bootcamp partition has not had this issue on ANY of the iMacs/li /ul  strongAlso, to rule out the obvious:/strong  ul liThere have been no brownouts or surges/li liWe seriously doubt a virus, as the malfunctions appear anywhere from simultaneously (two machines went down at the same time about a month ago) to months apart. Plus, the user's documents are restored after reformat, so one would surmise that if it were a malicious program the Mac would keep failing again and again./li liThe machines have been in a climate-controlled area/li liIt has not been the same user affected/li liSometimes the problem occurs after an unavoidable hard shutdown (which occurs only infrequently. These machines are not being excessively powered down improperly. Only what you would expect with a Mac Lab running multimedia five days a week), other times it is completely out-of-the-blue/li /ul  strongFrequently used software includes:/strong  ul liiPhoto/li liiDVD/li liiMovie/li liSafari/li /ul  The machines are also loaded with Parallels 5, which loads the Bootcamp partition into a VM. Parallels was setup via the standard wizard, no oddball configuration or hacks.  strongAnd last but not least, the specs:/strong  ul liiMac 10,1 (21.5 inch)/li liStock drives/li liOS X Snow Leopard (latest updates)/li liStock memory/li liJoined to our Active Directory infrastructure/li liHFS+ file system (not case sensitive, the default for OS X Snow Leopard)/li liNo out-of-the-ordinary drive maint. programs. Drive Genius was loaded yesterday afternoon (AFTER recovering from the latest failure) to run a verification on all iMacs, but was not installed prior. All Macs, both those that have failed in the past and those that have never failed, passed with flying colors./li /ul  strongTL;DR: The OS X partition has become corrupted on five different iMacs, but the physical drives are fine. WHY!?!?!/strong  <answer10379> Things that could do it off the top of my head...  you said you haven't had power surges or brownouts. How are you confirming it? We had a classroom where PC power supplies were blowing seemingly at random. We had to have maintenance staff connect a monitoring meter to the circuit and discovered that outlet is having huge voltage spikes.  Memory isn't seated properly and corrupting data.  Drive cables loose.  marginal hard disks that have a bad set of sectors but not bad enough that it's triggering alerts or scans for bad sectors.  Something in the Windows side via bootcamp is modifying the drive in a way the drive doesn't like. Copy protection? Drive utilities?  You said it's in a lab. What are the students running? Are you monitoring or locking down what can be executed that could be doing it?  You've said this seems to be random, no two machines having this happen in a row. This would lead me to suspect that either a student or group of students are causing it or there is a random power issue in the lab causing it. Is there a way of tracking who last used the machines to see if this issue seems to magically follow one of your users?  <answer11084> HFS Plus (HFS+) is a fragile and a little outdated filesystem. If you google it, you'll find many reports of filesystem corruption.  Rebooting without unmounting the filesystem is the best way to corrupt it. This happens when the mac freezes for some reason (in my case it's the nvidia video card) or power failures.  Here are some tips, that IMHO should lower the chance of filesystem corruption:  ol listrongWhen system freezes, try rebooting from ssh./strong When the graphics subsystem of my mac freeses, it's still accessible via SSH - try opening ssh connection from your network and reboot it. You could use Apple Remote Desktop (€62) for this task. You should enable ssh access first./li listrongDo codediskutil verifyVolume //code periodically./strong Yes, even if HFS+ is a journaled filesystem, corruption is possible. You could use Apple Remote Desktop to run this on all classroom computers at once./li listrongUse multiple volumes./strong Using multiple volumes should reduce chance for corruption. Splitting code//code from code/Users//code should make restoration easier (either / or /Users will be corrupted). Note that this probably could complicate things with Bootcamp./li listrongMount partition(s) with options, which reduce writing./strong Mounting partitions with codenoatime/code option should reduce writing on it. By default every time  a file is accessed, it's access timestamp is "touched"./li listrongMake sure there are no attempts to mount HFS+ partition from other os-es./strong Is it possible that someone is starting a linux distro from usb/dvd and mounting code//code in rw mode or playing with journal settings?/li /ol  Hope my answer is helpful.  PS: corruption usually is gradual not sudden. There is a possibility that something specific is causing this, software or workflow. My mind is at Parallels 5, but it should corrupt the bootcamp volume, not the MacOS one. Searching their KB does not reveal anything useful.  PPS: it is fragile because it has no actual system to correct corruption within a file. A journal records transfers and attempts to recopy data in order to return the filesystem to a consistent state but if the file lost is vital (like actual filesystem structure data) then there is no recourse. In fact, because the Catalog File (which is lists all the logical data information) is stored as a file, if it corrupted in certain places your entire filesystem is rendered useless garbage data, or partially tended garbage in the event that it is corrupted and the a journal replay occurs which causes it to restructure the filesystem in a way that is not consistent with the data (e.g. file a and b are 1MB and 2MB respectively  but the replay changes them to be 2MB and 1MB resulting in half of the contents of B being inside A).  <answer19108> Have you considered a periodic check of the machines? You could easily schedule weekly fsck verification passes (until you figure out why the corruption is happening) and then monthly to keep a tab on things.  With a journaled file system, it takes some repeated bad treatment for macs to degrade to the point of not booting. Even bad software doesn't write to the system side of booting, so I would suspect something is clearly amiss. On macs that get shut down cleanly and get attention the whenever minor filesystem errors are repaired (any time a mac restarts and fsck isn't running in preen mode is a sign of trouble on the horizon).  With a deployment of 25 macs, you can easily spend some time being proactive about file system checks and seeing which are not powering down cleanly by setting up a syslog server  or other centralized auditing system.  <answer82593> I would consider student activity.  If you are running bootcamp and OS X, then I bet the students are crashing the Mac side to run boot camp, because they aren't patient.  This can also be the case if there is a screen locker present.  I suggest:  ol liRemove boot camp.  Instead run a VM either under Parallels or Virtual Box.  (I have found that Windows XP under VirtualBox runs quite well.)  Configure this so that the Virtual Machine is immutable, stored locally on the old bootcamp partition.  This will prevent kids from screwing around with the windows install.  Redirect their home directory to read off of their Mac home directory on your server.  (This is a PITA to set up the first time, as it encompasses about a zillion regedits)/li liEstablish some form of login monitoring so you know which students have used which machines.  This has the advantage that you can spot the same kid logging in on multiple machines, usually doing this as a favour for someone who is banned.   I set it up that when the same login was on two machines, both machines were rebooted./li /ol  <comment10876> We have not been using any power monitoring equipment, no. Simply going off the report from the teachers at the high school on that one. *edit* GAH! Note to self: the enter key does not create a new line in comment mode. <comment10878> Might want to try that. There were no indications of such an issue in the classroom, either, but the IT director was an electrical engineering major in college and had them check it. He did the math and found that they were having periodic spikes of thousands of volts... <comment10879> We've done a RAM test on each machine that has had this problem, they all passed. You'd think that if the drive cables were loose the problem would have manifested itself on the same machine a few times on the same iMac, rather than on multiple iMacs. Also, if it were a loose drive cable it's odd that it hasn't occurred to the Bootcamp partitions. <comment10882> It's possible that the drives are indeed marginal, but I have a hard time buying that one. I've checked, re-checked, and triple checked these drives. I've used Apple's Disk Utility as well as Drive Genius 3 to scan the snot out of the disks. Also, I've never seen a marginal drive without having at least a few indicators in SMART. I've seen "bad" hard disks that passed SMART, but they still had high relocated sector counts and whatnot when using a SMART utility. These drives? Nada. <comment10884> I've thought of Windows screwing with the Mac partition, and I still haven't ruled it out. However, the fact that Apple's bootcamp driver will ONLY mount HFS+ partitions as read-only seems to preclude that. We aren't using any disk tools or "deep freeze" type utilities on the Windows side. <comment10885> You're not...but what about your users? Are you locking out what they can or can't run? Is it possible you have a unique snowflake that found a fun toy online or is running something that is trying to modify the disk directly? <comment10889> LOL @ "unique snowflake." As for lockout, all students (and 95% of teachers for that matter) run as limited user accounts in both Windows and Mac. Also, the teacher and students in the Multimedia class are some of the best at this particular school. Not to say that we don't have a misfit, because it's quite possible. Students are also assigned specific machines, so the likelihood of a troublemaker getting access to each of these five machines without drawing attention would be difficult. I'm working my way through each of your questions, but please don't take my answers as being dismissive. <comment10894> 133t self-styled hackerz aren't limited to kids who spend many days in the principal's office... <comment10895> Or there could be Windows-borne malware that is trying to do something to the partition table while bootcamped. <comment10898> I agree that students can indeed be silently malicious, but this just doesn't strike me as deliberately induced failure. I know my clientele, and in our case the students are either overtly (and clumsily) malicious, or just "normal" computer users. Also, the user on each machine has been inconvenienced by losing access to their documents for days at a stretch (We have yet to map user documents from these Macs to network shares.) <comment10899> As for Windows malaware, also a possibility. We do run antivirus on all Windows machines (including the Bootcamped Macs) in the district (Avast, network managed) and  there have been no warnings on any of the Bootcamped Macs. Also, because teachers and users run with limited privileges, the worst "viruses" we see are rouge antivirus programs that run only with the limited privileges of the user that was duped into installing the program. All we have to do to remove said rouge malware is delete the user's local account and let it rebuild on next login. <comment13865> Any filesystem will have problems considering circumstances. But "Fragile" and "A Little Outdated"? Really? A little outdated in my mind is no Journaling. And that's not the case for HFS+. <comment13866> Off Topic: 8¼b: You can use Shift+Enter to enter linebreaks into comment boxes.  I've also heard that there are browser plugins (userscripts?) out there that reverses the role of enter & shift-enter, so enter will insert a line break, and shift-enter will submit the comment. <comment18202> +1 well documented question. Have you ever considered that it could be an act by students? <comment20922> If the filesystem were fragile, wouldn't all of the macs have issues? Installations with hundreds of macs that audit for abrupt power disconnects and a rolling schedule of safe boots, file system repairs will nip this sort of thing in the bud. <comment20923> How does iMac 10,1 map to iMac {early|mid|late} 20YX for ease in looking into the hardware side of things? If you replace the #desktopcomputers with one of the serial numbers, http://support.apple.com/manuals/#desktopcomputers will get the descriptive name for your iMacs. <comment199299> +1 for HFS Plus (HFS+) is a fragile file system. I've experienced this exact scenario with two hard drives. Windows is unaffected, hfs+ can't be repaired. Recreating partition and reinstalling os x works fine