Updating modifier key mappings through defaults command tool <body> I am trying to automate the inital setup  of my macbook, that includes installing software and changing OS X configuration to my needs.  I have tried to update the modifier keys with defaults, the code is as follow:  precode# The apple keyboard id (1452-567-0) should probably be modified in case you use other different model  COMPUTER_UUID=`ioreg -rd1 -c IOPlatformExpertDevice | grep -E '(UUID)' | awk '{print $3}' | tr -d \"` defaults write ~/Library/Preferences/ByHost/.GlobalPreferences.$COMPUTER_UUID com.apple.keyboard.modifiermapping.1452-567-0 '( { HIDKeyboardModifierMappingDst = 2;   HIDKeyboardModifierMappingSrc = 0; } )' /code/pre  The problem seems that even if the pattern is changed the System Preferences does not catch the update, not even restarting the computer.  Is there any way to perform this operation in Snow Leopard?  Thanks.  <answer13638> ul liHave you run codediff/code to verify you're creating this file exactly as the UI would?/li liRun codefs_usage/code or codelsof/code to find out what else is being done when you use the UI./li /ul  <answer15090> I, too, have been unable to get codedefaults write/code (or updating .plist files) to affect my strongHIDKeyboardModifierMappingSrc/strong and strongHIDKeyboardModifierMappingDst/strong settings under strongSnow Leopard/strong.  I'm trying to "pre-populate" my Guest account to support my PS2-to-USB keyboard (which apparently has Option and Command swapped.)  Other pages' suggestions to "log out and log back in" don't help; "logging out" of the Guest account deletes all my changes.  (I emhave/em successfully updated my "com.apple.dock" and "com.apple.menuextra.clock" plist files to customize the dock and the 24-hour clock, respectively, which makes it even more frustrating that the Keyboard Modifiers won't work...)  I've tried using "dtruss -asf" to compare what "System Preferences.app" is doing (which apparently works) to what "defaults" is doing.  Nearest I can figure, I see messages along the lines of:  precode   Foundation`+[__NSOperationInternal _observeValueForKeyPath:ofObject:changeKind:oldValue:newValue:indexes:context:]+0x151    Foundation`NSKeyValueNotifyObserver+0x81    Foundation`NSKeyValueDidChange+0x1ca    Foundation`-[NSObject(NSKeyValueObservingPrivate) _changeValueForKey:usingBlock:]+0x176 /code/pre  If anybody's figured out a solution that works under Snow Leopard, I'd be happy to hear it...  <answer88096> It's important for the codedefaults/code command to use the correct "keyboard ID" in the key, it seems to be: codecom.apple.keyboard.modifiermapping.$VendorID-$ProductID-0/code  For example the internal keyboard for my MacBook Air uses: codecom.apple.keyboard.modifiermapping.1452-579-0/code, while the external keyboard on my iMac uses codecom.apple.keyboard.modifiermapping.1118-219-0/code  How to get the correct "keyboard ID"? On the command line you can use:  precodeioreg -p IOUSB -c IOUSBDevice | grep -e class -e idVendor -e idProduct /code/pre  to get a list of your USB devices with the relevant parameters:  precode  [...]   +-o Natural® Ergonomic Keyboard 4000@fa140000  &lt;class IOUSBDevice, id 0x100000452, registered, matched, active, busy 0 (115 ms), retain 12&gt;         "idProduct" = 219         "idVendor" = 1118 /code/pre  My guess is that the third parameter (the "-0" part) is a "counter", in case you have more than one keyboard of the same type.  So, to switch off the CapsLock key on my external keyboard I can now use:  precodedefaults -currentHost write -g com.apple.keyboard.modifiermapping.1118-219-0 -array-add '&lt;dict&gt;&lt;key&gt;HIDKeyboardModifierMappingDst&lt;/key&gt;&lt;integer&gt;-1&lt;/integer&gt;&lt;key&gt;HIDKeyboardModifierMappingSrc&lt;/key&gt;&lt;integer&gt;0&lt;/integer&gt;&lt;/dict&gt;' /code/pre  hr  And, for completeness' sake, here's a list of possible key codes to use (from Mac OS X Hints):  ul liNone — –1/li liCaps Lock — 0/li liShift (Left) — 1/li liControl (Left) — 2/li liOption (Left) — 3/li liCommand (Left) — 4/li liKeypad 0 — 5/li liHelp — 6/li liShift (Right) — 9/li liControl (Right) — 10/li liOption (Right) — 11/li liCommand (Right) — 12/li /ul  hr  strongUpdate:/strong thanks to Lauri Ranta here's a command that works for Bluetooth &amp; USB keyboards:  precodeioreg -n IOHIDKeyboard -r | grep -e 'class IOHIDKeyboard' -e VendorID\" -e Product /code/pre  which gives you slightly different output:  precode+-o IOHIDKeyboard  &lt;class IOHIDKeyboard, id 0x100000489, registered, matched, active, busy 0 (0 ms), retain 8&gt;   |   "Product" = "Apple Wireless Keyboard"   |   "VendorID" = 1452   |   "ProductID" = 570 /code/pre  <answer122573> The problem I'm having is that every time I plug my keyboard in, it gets a different ID in ioreg. All I need to do is swap the command and the apple keys.  I decided to solve this in my case the "wrong way" using AppleScript and the System Preferences GUI. It's an ugly hack, but it works! Your mileage may vary.  precode--The beginning of the name of the target keyboard (to type into the drop-down selection list) set keyboardName to "natural"  --reboot system preferences to make GUI state more predictable tell application "System Preferences"     quit     delay 1     activate     delay 1     activate end tell  tell application "System Events"      --Bring up keyboard prefs     key code 53 --escape     keystroke "f" using command down     delay 0.5     key code 53 --escape     keystroke "keyboard"     delay 0.5     key code 36 --return     delay 1      --Open modifier keys submenu     repeat 4 times         keystroke tab using shift down         --delay 0.1     end repeat     --delay 0.1     keystroke space     delay 0.1      --Select keyboard     keystroke space     keystroke keyboardName     keystroke return     delay 0.1      --Select "option key" drop-down     repeat 3 times         keystroke tab     end repeat      delay 0.5      --Open drop-down and go to top     keystroke space     delay 0.1     repeat 4 times         key code 126 --up arrow     end repeat      --Select "command" option     repeat 3 times         key code 125 --down arrow     end repeat     delay 0.1      keystroke return      -- Select "command key" drop-down     keystroke tab     delay 0.1      --Open drop-down and go to top     keystroke space     delay 0.1     repeat 4 times         key code 126 --up arrow     end repeat      --Select "command" option     repeat 2 times         key code 125 --down arrow     end repeat     delay 0.1      keystroke return     delay 0.1      --Commit changes! phew.     keystroke return end tell /code/pre  <comment14592> use `defaults -currentHost write -g key 'value'` instead. Still doesn't work though. <comment14593> `fs_usage` doesn't show anything interesting AFAICT, and I verified (with my modified command in the comment to the question) that the result shows up as one would expect. <comment14594> [This guy](http://forums.macrumors.com/showthread.php?t=949280) attempts something similar and also failed. Would AppleScript GUI scripting be a viable option for you? <comment103111> Do **not** use the shorter version of the defaults value `'{ HIDKeyboardModifierMappingDst = -1; HIDKeyboardModifierMappingSrc = 0; }'` that you can find on some websites, at least for me the "-1" and "0" in the dict's values are then interpreted as strings, not integers.  That leads to a strange state where Preferences shows the changed modifier keys, but the keyboard doesn't actually behave that way. <comment103161> `ioreg -n IOHIDKeyboard -r` would also include Bluetooth keyboards. <comment166192> I did this but it doesn't seem to take any effect. Do I need to restart something for it to work? <comment185916> @SimonW I experienced the same. I found that simply logging out and back in again makes the setting take effect. <comment185954> That ain't fun :( <comment353983> Could this be used in Sierra to get this to work https://apple.stackexchange.com/questions/280855/changing-right-hand-command-alt-key-order-to-be-like-a-windows-keyboard